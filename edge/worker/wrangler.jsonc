{
  "$schema": "./node_modules/wrangler/config-schema.json",
  "name": "interview-feedback-gateway",
  "main": "src/index.ts",
  "compatibility_date": "2026-02-11",
  "workers_dev": true,
  "routes": [
    {
      "pattern": "api.frontierace.ai",
      "custom_domain": true,
      "zone_name": "frontierace.ai"
    }
  ],

  "vars": {
    "INFERENCE_BASE_URL_PRIMARY": "http://127.0.0.1:8000",
    "INFERENCE_BASE_URL_SECONDARY": "https://if.frontierace.ai",
    "INFERENCE_TIMEOUT_MS": "60000",
    "INFERENCE_FAILOVER_ENABLED": "true",
    "INFERENCE_RETRY_MAX": "2",
    "INFERENCE_RETRY_BACKOFF_MS": "180",
    "INFERENCE_CIRCUIT_OPEN_MS": "15000",
    "INFERENCE_RESOLVE_PATH": "/speaker/resolve",
    "INFERENCE_ENROLL_PATH": "/speaker/enroll",
    "INFERENCE_EVENTS_PATH": "/analysis/events",
    "INFERENCE_REPORT_PATH": "/analysis/report",
    "INFERENCE_REGENERATE_CLAIM_PATH": "/analysis/regenerate-claim",
    "INFERENCE_RESOLVE_AUDIO_WINDOW_SECONDS": "6",
    "ASR_PROVIDER": "local-whisper",
    "ASR_ENDPOINT": "http://127.0.0.1:8000",
    "ASR_LANGUAGE": "auto",
    "ASR_ENABLED": "true",
    "ASR_MODEL": "large-v3",
    "ASR_WS_URL": "wss://dashscope.aliyuncs.com/api-ws/v1/inference/",
    "ASR_WINDOW_SECONDS": "10",
    "ASR_HOP_SECONDS": "10",
    "ASR_TIMEOUT_MS": "600000",
    "ASR_REALTIME_ENABLED": "true",
    "ASR_SEND_PACING_MS": "0",
    "ASR_STREAM_CHUNK_BYTES": "12800",
    "ASR_DEBUG_LOG_EVENTS": "false",
    "MEMOS_ENABLED": "true",
    "FINALIZE_V2_ENABLED": "true",
    "FINALIZE_TIMEOUT_MS": "1800000",
    "FINALIZE_WATCHDOG_MS": "2400000",
    "DIARIZATION_BACKEND_DEFAULT": "local",
    "AUDIO_RETENTION_HOURS": "72",
    "TIER2_ENABLED": "true",
    "TIER2_AUTO_TRIGGER": "true",
    "TIER2_BATCH_ENDPOINT": "http://127.0.0.1:8000/batch/process",
    "WORKER_API_KEY": "",
    "DEFAULT_LOCALE": "zh-CN",
    "CAPTION_PROVIDER": "acs-teams",
    "CAPTION_FALLBACK_TO_ASR": "true",
    "INCREMENTAL_ENABLED": "false",
    "INCREMENTAL_INTERVAL_MS": "180000",
    "INCREMENTAL_OVERLAP_MS": "30000",
    "INCREMENTAL_CUMULATIVE_THRESHOLD": "2",
    "INCREMENTAL_ANALYSIS_INTERVAL": "2"
  },

  "durable_objects": {
    "bindings": [
      {
        "name": "MEETING_SESSION",
        "class_name": "MeetingSessionDO"
      }
    ]
  },

  "migrations": [
    {
      "tag": "v1",
      "new_sqlite_classes": ["MeetingSessionDO"]
    }
  ],

  "r2_buckets": [
    {
      "binding": "RESULT_BUCKET",
      "bucket_name": "interview-feedback-results"
    }
  ]
}
