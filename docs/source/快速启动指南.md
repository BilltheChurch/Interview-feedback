# 快速启动指南（开发者）｜v4.1

**更新日期**：2026-02-11  
**目标**：在本机跑通 “Electron → Cloudflare → 推理服务 → Fun-ASR” 的最小闭环。

---

## 0. 你需要准备的账号与密钥
- Cloudflare：Workers + Durable Objects + R2
- 阿里云百炼：DashScope API Key（Fun-ASR realtime）
- GPU/推理平台：一个可公开访问的 HTTPS 推理服务地址（或本地 ngrok）

---

## 1. 本地启动推理服务（Docker）

### 1.1 目录结构（建议）
```
inference/
  Dockerfile
  app.py
  models/
```

### 1.2 必须实现的接口
- `POST /health`
- `POST /diarize`：输入 audio，输出 segments
- `POST /enroll`：输入 audio + person_id，输出 enroll_id + embedding（服务端保存）
- `POST /identify`：输入 embedding（probe）+ enroll_db（或 speaker_ids），输出 top1 + score + decision

✅ 验证：
```bash
curl -s http://localhost:8080/health
```

---

## 2. Cloudflare Worker/DO

### 2.1 初始化
```bash
npm i -g wrangler
wrangler init interview-ai
```

### 2.2 绑定资源
- R2 bucket：`meeting-audio`
- Durable Object：`MeetingSession`

### 2.3 配置 secrets
```bash
wrangler secret put ALIYUN_DASHSCOPE_API_KEY
wrangler secret put INFERENCE_BASE_URL
wrangler secret put INFERENCE_API_KEY
wrangler secret put SV_MODEL_ID
wrangler secret put SV_T_LOW
wrangler secret put SV_T_HIGH
```
### 2.3.1 说话人确认（SV）默认模型（已定稿）
- `SV_MODEL_ID=iic/speech_campplus_sv_zh_en_16k-common_advanced`
- `SV_SAMPLE_RATE=16000`
- `SV_T_LOW` / `SV_T_HIGH`：阈值（写入 Worker/推理服务配置，禁止硬编码）


### 2.4 本地运行
```bash
wrangler dev
```

✅ 验证：
- `GET http://localhost:8787/health` 返回 200

---

## 3. Electron（Mac）

### 3.1 启动
```bash
cd desktop
pnpm i
pnpm dev
```

### 3.2 自检
1. 打开 Teams 会议
2. App 点【音频自检】
3. 观察电平条（远端/本地）
4. 点击【录 30 秒】→【回放】

✅ 通过标准
- 能清晰听到双向声音

---

## 4. 端到端联调（最小闭环）

### 4.1 测试会议
- 2 人会议（你 + 1 学生）
- 先不做 enrollment

### 4.2 观察数据流
- R2：每秒生成 1 个 chunk 对象
- DB：写入 `utterances_raw`（先整段识别）
- 控制台：无连续报错

✅ 通过标准
- 5 分钟不断流
- ASR 每 10 秒生成一条结果

---

## 5. 加入 enrollment + speaker 绑定

### 5.1 操作
1. 进入会议页 → 点击【开始 enrollment】
2. 学生按提示自我介绍 5–8 秒
3. UI 显示“已捕获/已绑定/待确认”

✅ 通过标准
- speaker_name 出现在 utterances 中
- 绑定稳定（不频繁跳人）

---

## 6. 进入反馈模式
1. 面试两题结束 → 点击【进入反馈】
2. 首屏立即出现（可先简版）
3. 逐步补全证据引用与更完整分析

